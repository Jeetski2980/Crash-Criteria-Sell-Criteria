//@version=6
indicator("SPY Buy Signal (Based on Original 4 Crash Rules)", overlay=true)

// === Daily % Drop Checks ===
priceDrop = (close - close[1]) / close[1] * 100
isDrop3   = priceDrop <= -3 ? 1 : 0
isDrop175 = priceDrop <= -1.75 ? 1 : 0

// === Original 4 Conditions ===
maxDrop12           = 100 * (close - ta.highest(close, 12)) / ta.highest(close, 12)
rolling6PercentDrop = maxDrop12 <= -6
rolling3PercentDay  = math.sum(isDrop3, 12) >= 1
rollingTwo175Days   = math.sum(isDrop175, 14) >= 2
vol14               = ta.sma(volume, 14)
vol30               = ta.sma(volume, 30)
volumeSpike         = vol14 >= 1.15 * vol30

// === Signal ===
buySignal = rolling6PercentDrop and rolling3PercentDay and rollingTwo175Days and volumeSpike

// === Plot Green Triangle with "BUY" Label ===
plotshape(buySignal, title="Buy Signal", location=location.belowbar, color=color.green, style=shape.triangleup, size=size.small, text="BUY")

// === Alert ===
alertcondition(buySignal, title="Buy Signal Triggered", message="SPY BUY signal triggered by original 4 crash rules")
